# –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π

## üî¥ –ü—É–Ω–∫—Ç 1: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç size_code

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

**–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–æ–ª–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:**
```
"92 - 2 –≥–æ–¥–∞"
"98 - 3 –≥–æ–¥–∞"
"104 - 4 –≥–æ–¥–∞"
...
```

**–ù–æ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ receipt_items –∏ realization_items —Ä–∞–∑–º–µ—Ä –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è:**
```typescript
// pages/api/receipts/create.ts:89
size_code: item.size_code.split(' ')[0]  // "92 - 2 –≥–æ–¥–∞" ‚Üí "92"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í —Ç–∞–±–ª–∏—Ü–µ `sizes`: `"92 - 2 –≥–æ–¥–∞"`
- –í —Ç–∞–±–ª–∏—Ü–µ `receipt_items`: `"92"`
- –í —Ç–∞–±–ª–∏—Ü–µ `realization_items`: `"92"`

### üîç –ì–¥–µ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è** (`pages/api/receipts/create.ts:89`):
```typescript
const receiptItems = items.map((item: any) => ({
  product_id: item.product_id,
  qty: item.quantity || item.qty || 0,
  size_code: item.size_code.split(' ')[0], // ‚ùå –û–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ "92"
  color_id: item.color_id || null
}));
```

2. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** (`pages/api/realization/create.ts:178`):
```typescript
const baseRows = items.map((it: any) => ({
  product_id: parseInt(it.product_id),
  size_code: it.size_code.split(' ')[0], // ‚ùå –û–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ "92"
  color_id: it.color_id,
  qty: parseInt(it.qty) || 0,
}));
```

3. **–ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** (`pages/api/receipts/create.ts:76`):
```typescript
const sizeNumber = item.size_code.split(' ')[0]; // –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è "92" –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
if (!childrenSizes.includes(sizeNumber)) {
  // –ø—Ä–æ–≤–µ—Ä–∫–∞
}
```

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –•—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–µ–∑–¥–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `"92 - 2 –≥–æ–¥–∞"` –≤ `receipt_items` –∏ `realization_items`:

```typescript
// –ë–´–õ–û:
size_code: item.size_code.split(' ')[0]  // "92"

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
size_code: item.size_code  // "92 - 2 –≥–æ–¥–∞"
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—É—é —á–∞—Å—Ç—å –≤–µ–∑–¥–µ**

–ï—Å–ª–∏ —Ä–µ—à–∏–º —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ `"92"`, —Ç–æ –Ω—É–∂–Ω–æ:
1. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `sizes` - —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ `"92"` –≤–º–µ—Å—Ç–æ `"92 - 2 –≥–æ–¥–∞"`
2. –û–±–Ω–æ–≤–∏—Ç—å API `sizes/by-category.ts` - –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ª—å–∫–æ `"92"`

### üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–í–∞—Ä–∏–∞–Ω—Ç –ê):

**–î–æ:**
```typescript
// pages/api/receipts/create.ts
size_code: item.size_code.split(' ')[0], // "92"
```

**–ü–æ—Å–ª–µ:**
```typescript
// pages/api/receipts/create.ts
size_code: item.size_code.trim(), // "92 - 2 –≥–æ–¥–∞" (–ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
```

**–ò –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```typescript
// –ë–´–õ–û:
const sizeNumber = item.size_code.split(' ')[0];
if (!childrenSizes.includes(sizeNumber)) { ... }

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const sizeNumber = item.size_code.split(' ')[0].trim(); // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
if (!childrenSizes.includes(sizeNumber)) { ... }
// –ù–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: size_code: item.size_code
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –†–∞–∑–º–µ—Ä—ã –≤ –ë–î `"92 - 2 –≥–æ–¥–∞"`, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ `"92"` ‚Üí –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –í–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç - –ª–∏–±–æ –ø–æ–ª–Ω—ã–π `"92 - 2 –≥–æ–¥–∞"`, –ª–∏–±–æ —Ç–æ–ª—å–∫–æ `"92"`

---

## üî¥ –ü—É–Ω–∫—Ç 2: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É color_id

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–í —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞ `color_id` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É:

### üîç –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:

**–ü–æ–¥—Ö–æ–¥ 1: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** (`pages/api/receipts/create.ts:63`):
```typescript
if (item.color_id !== null && item.color_id !== undefined && item.color_id !== 0) {
  const colorId = parseInt(item.color_id);
  if (isNaN(colorId) || colorId <= 0) {
    return res.status(400).json({ error: `–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ü–≤–µ—Ç–∞` });
  }
}
```

**–ü–æ–¥—Ö–æ–¥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ || null** (`pages/api/receipts/create.ts:90`):
```typescript
color_id: item.color_id || null  // –ï—Å–ª–∏ 0, —Ç–æ —Å—Ç–∞–Ω–µ—Ç null
```

**–ü–æ–¥—Ö–æ–¥ 3: parseInt —Å fallback** (`pages/api/stock/index.ts:174`):
```typescript
const colorId = row.color_id ? (parseInt(row.color_id) || row.color_id) : null;
```

**–ü–æ–¥—Ö–æ–¥ 4: –ü—Ä–æ—Å—Ç–æ–µ || null** (`pages/api/stock/stock-details.ts:78`):
```typescript
const colorId = row.color_id || null;
```

**–ü–æ–¥—Ö–æ–¥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 0** (`pages/realization/new.tsx:209`):
```typescript
if (!currentItem.color_id || currentItem.color_id === 0) {
  // –æ—à–∏–±–∫–∞
}
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:** –í –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ `color_id = 0` —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º, –≤ –¥—Ä—É–≥–æ–º - –Ω–µ—Ç
2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏:** –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –ø–æ-—Ä–∞–∑–Ω–æ–º—É
3. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏:** `color_id = 0` –º–æ–∂–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ `null` –∏–ª–∏ –∫–∞–∫ –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**

```typescript
// lib/utils/normalize.ts
/**
 * –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç color_id: –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —á–∏—Å–ª—É –∏–ª–∏ null
 * –ü—Ä–∞–≤–∏–ª–∞:
 * - null/undefined ‚Üí null
 * - 0 ‚Üí null (0 –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º ID)
 * - —Å—Ç—Ä–æ–∫–∞ "0" ‚Üí null
 * - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ ‚Üí —á–∏—Å–ª–æ
 * - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ ‚Üí –æ—à–∏–±–∫–∞
 */
export function normalizeColorId(value: any): number | null {
  if (value === null || value === undefined) {
    return null;
  }
  
  const num = typeof value === 'string' ? parseInt(value, 10) : Number(value);
  
  if (isNaN(num) || num <= 0) {
    return null; // 0 –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ ‚Üí null
  }
  
  return num;
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ:**

```typescript
// –ë–´–õ–û:
if (item.color_id !== null && item.color_id !== undefined && item.color_id !== 0) {
  const colorId = parseInt(item.color_id);
  // ...
}
color_id: item.color_id || null

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
import { normalizeColorId } from '../../../lib/utils/normalize';

const colorId = normalizeColorId(item.color_id);
// colorId –±—É–¥–µ—Ç –ª–∏–±–æ number (–µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π), –ª–∏–±–æ null
```

### üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**1. –í receipts/create.ts:**
```typescript
// –ë–´–õ–û:
if (item.color_id !== null && item.color_id !== undefined && item.color_id !== 0) {
  const colorId = parseInt(item.color_id);
  if (isNaN(colorId) || colorId <= 0) {
    return res.status(400).json({ error: `–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ü–≤–µ—Ç–∞` });
  }
}
// ...
color_id: item.color_id || null

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const colorId = normalizeColorId(item.color_id);
// –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è (color_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω):
if (colorId === null) {
  return res.status(400).json({ error: '–¶–≤–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
}
// ...
color_id: colorId  // —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω
```

**2. –í stock/index.ts:**
```typescript
// –ë–´–õ–û:
const colorId = row.color_id ? (parseInt(row.color_id) || row.color_id) : null;

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const colorId = normalizeColorId(row.color_id);
```

**3. –í realization/new.tsx:**
```typescript
// –ë–´–õ–û:
if (!currentItem.color_id || currentItem.color_id === 0) {
  // –æ—à–∏–±–∫–∞
}

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const colorId = normalizeColorId(currentItem.color_id);
if (colorId === null) {
  // –æ—à–∏–±–∫–∞
}
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** 5 —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `color_id` ‚Üí –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalizeColorId()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ ‚Üí –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ

---

## üî¥ –ü—É–Ω–∫—Ç 3: –£–¥–∞–ª–∏—Ç—å –¥–≤–æ–π–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Å—Ç–∞—Ç–∫–æ–≤

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–í `pages/api/realization/create.ts` –æ—Å—Ç–∞—Ç–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è **–¥–≤–∞–∂–¥—ã**:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1 (—Å—Ç—Ä–æ–∫–∏ 52-105):** –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å –∫ `receipt_items`
```typescript
// –ò—â–µ—Ç —Ç–æ–ª—å–∫–æ –≤ receipt_items (–ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!)
const { data: matches } = await supabaseAdmin
  .from('receipt_items')
  .select('...')
  .eq('product_id', item.product_id)
  .eq('size_code', sizeVariant)
  .eq('color_id', item.color_id);

// –°—É–º–º–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
const totalQty = matches.reduce((sum, match) => sum + (match.qty || 0), 0);

if (stockItem.qty < item.qty) {
  return res.status(400).json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞' });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! –û–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2 (—Å—Ç—Ä–æ–∫–∏ 141-150):** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `validateStockForItems`
```typescript
const stockValidation = await validateStockForItems(normalizedItems);
if (!stockValidation.valid) {
  return res.status(400).json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ' });
}
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç `receipt_items - realization_items`.

### ‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–µ—Ç **–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å** —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. –í—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ **–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è**, –Ω–æ –ø–µ—Ä–≤–∞—è –º–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ
3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ ‚Üí —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (—Å—Ç—Ä–æ–∫–∏ 52-130), –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤—Ç–æ—Ä—É—é:**

```typescript
// –ë–´–õ–û:
// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
for (const item of items) {
  // ... 50+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
  const sizeVariants = normalizeSizeForSearch(item.size_code);
  let stockItem = null;
  // ... –ø–æ–∏—Å–∫ –≤ receipt_items
  if (stockItem.qty < item.qty) {
    return res.status(400).json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞' });
  }
  // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ—Ç—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ
const stockValidation = await validateStockForItems(normalizedItems);
if (!stockValidation.valid) {
  return res.status(400).json({ error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞' });
}

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
// –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ—Ç—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
for (const item of items) {
  const { data: product } = await supabaseAdmin
    .from('products')
    .select('category_id')
    .eq('id', item.product_id)
    .single();
  
  if (product?.category_id === 3) {
    const sizeNumber = item.size_code.split(' ')[0].trim();
    if (!CHILDREN_SIZES.includes(sizeNumber)) {
      return res.status(400).json({ 
        error: `–î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ä–∞–∑–º–µ—Ä—ã –æ—Ç 92 –¥–æ 164` 
      });
    }
  }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ (–ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞)
const stockValidation = await validateStockForItems(normalizedItems);
if (!stockValidation.valid) {
  return res.status(400).json({ 
    error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ',
    details: stockValidation.errors.map(err => err.message)
  });
}
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –î–≤–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–¥–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è ‚Üí –ø—É—Ç–∞–Ω–∏—Ü–∞

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –û–¥–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `validateStockForItems` ‚Üí –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

---

## ‚ö†Ô∏è –ü—É–Ω–∫—Ç 4: –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–µ—Ç—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–°–ø–∏—Å–æ–∫ –¥–µ—Ç—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ **3 –º–µ—Å—Ç–∞—Ö**:

1. `pages/api/receipts/create.ts:74`
2. `pages/api/realization/create.ts:121`
3. `pages/api/stock/index.ts:276-277`

```typescript
// –í–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥:
const childrenSizes = ['92', '98', '104', '110', '116', '122', '134', '140', '146', '152', '158', '164'];
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:

- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤ 3 –º–µ—Å—Ç–∞—Ö
- –†–∏—Å–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π (–≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –∑–∞–±—ã–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å)
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ DRY (Don't Repeat Yourself)

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏:**

```typescript
// lib/constants.ts
/**
 * –î–µ—Ç—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã (–¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 3)
 * –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
 */
export const CHILDREN_SIZES = [
  '92', '98', '104', '110', '116', '122', 
  '134', '140', '146', '152', '158', '164'
] as const;

/**
 * –î–µ—Ç—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
 */
export const CHILDREN_SIZES_WITH_AGE = [
  '92 - 2 –≥–æ–¥–∞', '98 - 3 –≥–æ–¥–∞', '104 - 4 –≥–æ–¥–∞', '110 - 5 –ª–µ—Ç',
  '116 - 6 –ª–µ—Ç', '122 - 7 –ª–µ—Ç', '134 - 8 –ª–µ—Ç', '140 - 9 –ª–µ—Ç',
  '146 - 10 –ª–µ—Ç', '152 - 11 –ª–µ—Ç', '158 - 12 –ª–µ—Ç', '164 - 13 –ª–µ—Ç'
] as const;

/**
 * ID –¥–µ—Ç—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
 */
export const CHILDREN_CATEGORY_ID = 3;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ:**

```typescript
// –ë–´–õ–û:
const childrenSizes = ['92', '98', '104', '110', '116', '122', '134', '140', '146', '152', '158', '164'];
if (!childrenSizes.includes(sizeNumber)) { ... }

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
import { CHILDREN_SIZES, CHILDREN_CATEGORY_ID } from '../../../lib/constants';

if (product.category_id === CHILDREN_CATEGORY_ID) {
  if (!CHILDREN_SIZES.includes(sizeNumber)) { ... }
}
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –°–ø–∏—Å–æ–∫ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ 3 –º–µ—Å—Ç–∞—Ö ‚Üí —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –û–¥–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Üí –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

## ‚ö†Ô∏è –ü—É–Ω–∫—Ç 5: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–í —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø–æ-—Ä–∞–∑–Ω–æ–º—É –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —á–∏—Å–ª–æ–≤–∞—è —á–∞—Å—Ç—å —Ä–∞–∑–º–µ—Ä–∞:

**–í–∞—Ä–∏–∞–Ω—Ç 1:** `split(' ')[0]`
```typescript
// pages/api/receipts/create.ts:76
const sizeNumber = item.size_code.split(' ')[0];
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** `split(' ')[0].trim()`
```typescript
// pages/api/stock/index.ts:286
const sizeNumber = size.split(' ')[0].trim();
```

**–í–∞—Ä–∏–∞–Ω—Ç 3:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `normalizeSizeForSearch`
```typescript
// pages/api/realization/create.ts:11-34
function normalizeSizeForSearch(sizeCode: string): string[] {
  // ... –º–Ω–æ–≥–æ –∫–æ–¥–∞
}
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:

- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é:**

```typescript
// lib/utils/normalize.ts
/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç —á–∏—Å–ª–æ–≤—É—é —á–∞—Å—Ç—å —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
 * "92 - 2 –≥–æ–¥–∞" ‚Üí "92"
 * "98 - 3 –≥–æ–¥–∞" ‚Üí "98"
 * "M" ‚Üí "M"
 * "XL" ‚Üí "XL"
 */
export function extractSizeNumber(sizeCode: string): string {
  if (!sizeCode) return '';
  return sizeCode.split(' ')[0].trim();
}

/**
 * –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–∞–∑–º–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
 * –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–æ–∑—Ä–∞—Å—Ç ("92 - 2 –≥–æ–¥–∞"), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
 * –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ ("92"), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ –µ—Å—Ç—å
 */
export function normalizeSizeCode(sizeCode: string): string {
  if (!sizeCode) return '';
  return sizeCode.trim();
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ:**

```typescript
// –ë–´–õ–û:
const sizeNumber = item.size_code.split(' ')[0];
const sizeNumber = size.split(' ')[0].trim();

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
import { extractSizeNumber, normalizeSizeCode } from '../../../lib/utils/normalize';

const sizeNumber = extractSizeNumber(item.size_code); // –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
const normalizedSize = normalizeSizeCode(item.size_code); // –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ ‚Üí –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `extractSizeNumber()` ‚Üí –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ

---

## ‚ö†Ô∏è –ü—É–Ω–∫—Ç 6: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–í `pages/api/realization/create.ts` (—Å—Ç—Ä–æ–∫–∏ 52-105) –æ—Å—Ç–∞—Ç–æ–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**:

```typescript
// –ò—â–µ—Ç —Ç–æ–ª—å–∫–æ –≤ receipt_items (–ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!)
const { data: matches } = await supabaseAdmin
  .from('receipt_items')
  .select('...')
  .eq('product_id', item.product_id)
  .eq('size_code', sizeVariant)
  .eq('color_id', item.color_id);

// –°—É–º–º–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
const totalQty = matches.reduce((sum, match) => sum + (match.qty || 0), 0);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è.

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:**
```typescript
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: receipt_items - realization_items
const receiptQty = /* —Å—É–º–º–∞ –∏–∑ receipt_items */;
const realizationQty = /* —Å—É–º–º–∞ –∏–∑ realization_items */;
const availableQty = Math.max(0, receiptQty - realizationQty);
```

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É** (–æ–Ω–∞ —É–∂–µ –µ—Å—Ç—å –≤ `validateStockForItems`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è).

–°–º. –ø—É–Ω–∫—Ç 3 –≤—ã—à–µ.

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ ‚Üí –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä –∫–∞–∫ –¥–æ—Å—Ç—É–ø–Ω—ã–π, —Ö–æ—Ç—è –æ–Ω —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ `validateStockForItems` ‚Üí —Ç–æ—á–Ω–æ—Å—Ç—å

---

## ‚ö†Ô∏è –ü—É–Ω–∫—Ç 7: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å receipt_id/realization_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ–π—á–∞—Å:

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è/—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:

**receipts/create.ts:**
```typescript
// –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ
const { data: receipt } = await supabaseAdmin
  .from('receipts')
  .insert({ ... })
  .select()
  .single();

// –°–æ–∑–¥–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ë–ï–ó receipt_id
const receiptItems = items.map((item: any) => ({
  product_id: item.product_id,
  qty: item.quantity,
  size_code: item.size_code.split(' ')[0],
  color_id: item.color_id || null
  // ‚ùå –ù–ï–¢ receipt_id!
}));

await supabaseAdmin.from('receipt_items').insert(receiptItems);
```

**realization/create.ts:**
```typescript
// –°–æ–∑–¥–∞–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
const { data: realization } = await supabaseAdmin
  .from('realization')
  .insert({ ... })
  .select()
  .single();

// –°–æ–∑–¥–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ë–ï–ó realization_id
const baseRows = items.map((it: any) => ({
  product_id: parseInt(it.product_id),
  size_code: it.size_code.split(' ')[0],
  color_id: it.color_id,
  qty: parseInt(it.qty) || 0,
  // ‚ùå –ù–ï–¢ realization_id!
}));
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:

- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –ù—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `fill-foreign-keys.js` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –°–≤—è–∑—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ–Ω–∞–¥–µ–∂–Ω–æ)

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

**–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å—Ä–∞–∑—É:**

```typescript
// –ë–´–õ–û:
const receiptItems = items.map((item: any) => ({
  product_id: item.product_id,
  qty: item.quantity,
  size_code: item.size_code,
  color_id: item.color_id || null
  // –ù–ï–¢ receipt_id
}));

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const receiptItems = items.map((item: any) => ({
  product_id: item.product_id,
  qty: item.quantity,
  size_code: item.size_code,
  color_id: item.color_id || null,
  receipt_id: receipt.id  // ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–∞–∑—É!
}));
```

**–¢–æ –∂–µ –¥–ª—è realization:**

```typescript
const baseRows = items.map((it: any) => ({
  product_id: parseInt(it.product_id),
  size_code: it.size_code,
  color_id: it.color_id,
  qty: parseInt(it.qty) || 0,
  realization_id: realization.id  // ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–∞–∑—É!
}));
```

### üéØ –ò—Ç–æ–≥:

**–°–µ–π—á–∞—Å:** –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è ‚Üí –Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É ‚Üí –Ω–∞–¥–µ–∂–Ω–∞—è —Å–≤—è–∑—å

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü—É–Ω–∫—Ç | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------|----------|---------|-----------|
| 1 | –§–æ—Ä–º–∞—Ç size_code –Ω–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å (–ø–æ–ª–Ω—ã–π –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 2 | color_id –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É | –°–æ–∑–¥–∞—Ç—å `normalizeColorId()` | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 3 | –î–≤–æ–π–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ | –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–≤—É—é (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 4 | –î–µ—Ç—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è | –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É | ‚ö†Ô∏è –í–∞–∂–Ω–æ |
| 5 | –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ | –°–æ–∑–¥–∞—Ç—å `extractSizeNumber()` | ‚ö†Ô∏è –í–∞–∂–Ω–æ |
| 6 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ | –£–¥–∞–ª–∏—Ç—å (—É–∂–µ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è) | ‚ö†Ô∏è –í–∞–∂–Ω–æ |
| 7 | receipt_id/realization_id –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ | ‚ö†Ô∏è –í–∞–∂–Ω–æ |

---

## üéØ –†–µ–∑—é–º–µ

**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:** –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏.

**–ì–ª–∞–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
3. –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (`normalizeColorId`, `extractSizeNumber`)
2. –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`CHILDREN_SIZES`)
3. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É
4. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

